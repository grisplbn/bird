using Client.Acceptance.Tests.Infrastructure.Logging;

namespace Client.Acceptance.Tests.Configuration;

[Collection("SharedCollectionDefinition")]
public abstract class SharedCollectionTestBase
{
    // Statyczny ctor uruchomi się raz na assembly i przygotuje Trace.
    static SharedCollectionTestBase()
    {
        // pierwszy log zawoła EnsureTraceListeners, ale ten „touch” gwarantuje JIT
        // i od razu odczyta ENV HTTP_LOG=1 (jeśli ustawione) przez pole _globalEnabled.
        _ = typeof(LoggingHub);
    }

    /// <summary>
    /// Globalne sterowanie logami dla całego przebiegu testów.
    /// Użyj raz (np. w static ctorze klasy bazowej nadrzędnej) jeśli chcesz wymusić.
    /// Alternatywa: ustaw zmienną środowiskową HTTP_LOG=1.
    /// </summary>
    protected static void SetGlobalLogging(bool enabled) => LoggingHub.SetGlobal(enabled);

    /// <summary>
    /// Per-test przełącznik. W teście wpisz: enableLogging = true; aby włączyć logi tylko dla tego testu.
    /// Bez tej linijki – logi są wyłączone (chyba że globalnie włączone).
    /// </summary>
    protected bool enableLogging
    {
        set => LoggingHub.SetForCurrentTest(value);
    }
}
